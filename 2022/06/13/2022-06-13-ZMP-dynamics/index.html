

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/avatar2.png">
  <link rel="icon" href="/img/avatar2.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Jude">
  <meta name="keywords" content="">
  
    <meta name="description" content="Introduction ZMP (Zero moment point) is used for legged locomotion control, specifying the point with respect to which dynamic reaction force at the contact of the foot with the ground does not produ">
<meta property="og:type" content="article">
<meta property="og:title" content="行走机器人课程-ZMP双足控制与动力学">
<meta property="og:url" content="https://judera9.github.io/2022/06/13/2022-06-13-ZMP-dynamics/index.html">
<meta property="og:site_name" content="Jude&#39;s Blog">
<meta property="og:description" content="Introduction ZMP (Zero moment point) is used for legged locomotion control, specifying the point with respect to which dynamic reaction force at the contact of the foot with the ground does not produ">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/Judera9/Pictures-for-Blogs@main/img/2022/others/image-20220317142420502.png">
<meta property="article:published_time" content="2022-06-13T15:24:22.000Z">
<meta property="article:modified_time" content="2022-06-13T15:32:57.381Z">
<meta property="article:author" content="Jude">
<meta property="article:tag" content="ZMP">
<meta property="article:tag" content="Dynamics">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/Judera9/Pictures-for-Blogs@main/img/2022/others/image-20220317142420502.png">
  
  
  <title>行走机器人课程-ZMP双足控制与动力学 - Jude&#39;s Blog</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hint.css@2/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"judera9.github.io","root":"/","version":"1.8.14","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 6.0.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Jude&#39;s Blog</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home Page
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archive
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Category
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tag
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                About Me
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/default7.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="行走机器人课程-ZMP双足控制与动力学">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2022-06-13 23:24" pubdate>
        2022年6月13日 晚上
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      12k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      103 分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">行走机器人课程-ZMP双足控制与动力学</h1>
            
            <div class="markdown-body">
              <h2 id="introduction">Introduction</h2>
<p>ZMP (Zero moment point) is used for legged locomotion control, specifying <strong>the point with respect to which dynamic reaction force at the contact of the foot with the ground does not produce any moment in the horizontal direction</strong>. The concept assumes the contact area is planar and has sufficiently high friction to keep the feet from sliding.</p>
<p><img src="https://cdn.jsdelivr.net/gh/Judera9/Pictures-for-Blogs@main/img/2022/others/image-20220317142420502.png" srcset="/img/loading.gif" lazyload alt="image-20220317142420502" style="zoom:50%;" /></p>
<p>The following figure demonstrates how ZMP works for discussing robot's motion and the ground reaction force. The left figure using <strong>inertia force</strong>, which learned in high school, for expressing the effect of acceleration. The right figure is simply doing force balancing.</p>
<p><img src="https://cdn.jsdelivr.net/gh/Judera9/Pictures-for-Blogs@main/img/2022/others/image-20220319102806761.png" srcset="/img/loading.gif" lazyload alt="image-20220319102806761" style="zoom:67%;" /></p>
<h2 id="zmp-analysis">ZMP Analysis</h2>
<h3 id="convex-set-and-convex-hull">Convex Set and Convex Hull</h3>
<p>These two concepts are sued to introduce the support polygon concept, which depicts the region of the ZMP. <strong>If a segment by connecting any arbitrary two points included in the set <span class="math inline">\(S\)</span> is also included in <span class="math inline">\(S\)</span>, the set is defined to be the convex set</strong>. In equation, A subset <span class="math inline">\(S\)</span> of <span class="math inline">\(R^n\)</span> is defined to be the convex set if (<span class="math inline">\(\alpha\)</span> depicts positions between <span class="math inline">\(p_1,p_2\)</span>): <span class="math display">\[
\alpha p_1 + (1 -\alpha)p_2 \in S
\]</span> <img src="https://cdn.jsdelivr.net/gh/Judera9/Pictures-for-Blogs@main/img/2022/others/image-20220317151756410.png" srcset="/img/loading.gif" lazyload alt="image-20220317151756410" style="zoom:67%;" /></p>
<p>The minimum convex set including <span class="math inline">\(S\)</span> is defined to be the convex hull <span class="math inline">\(coS\)</span>, that is, <strong>the minimum polygon area containing all the vector of edges <span class="math inline">\(p_j \quad (j=1,...,N)\)</span> of a subset <span class="math inline">\(S\)</span> of <span class="math inline">\(R^n\)</span> corresponds to the convex hull</strong>: <span class="math display">\[
coS=\left\{\sum^{N}_{j=1}\alpha_jp_j | \alpha_j \geq 0, \sum^{N}_{j=1}\alpha_j=1,p_j \in S \quad (j=1,...,N)\right\}
\]</span> <img src="https://cdn.jsdelivr.net/gh/Judera9/Pictures-for-Blogs@main/img/2022/others/image-20220317154131122.png" srcset="/img/loading.gif" lazyload alt="image-20220317154131122" style="zoom:67%;" /></p>
<h3 id="zmp-and-com">ZMP and CoM</h3>
<p><strong>Zero momentum always exists inside of the support polygon</strong>, while CoM may lays on the outside when body moves dynamically, like the following figure. When the ground projection of CoM coincides with ZMP, the body can keep balance.</p>
<p><img src="https://cdn.jsdelivr.net/gh/Judera9/Pictures-for-Blogs@main/img/2022/others/image-20220317154709012.png" srcset="/img/loading.gif" lazyload alt="image-20220317154709012" style="zoom:67%;" /></p>
<h3 id="d-analysis">2D Analysis</h3>
<p>From the knowledge of mechanics, we know that the ground reaction force can be analyzed separately as vertical component <span class="math inline">\(\rho(\xi)\)</span> and horizontal component <span class="math inline">\(\sigma(\xi)\)</span>. Then equivalent them to the ZMP, we got the following relationships:</p>
<p><img src="https://cdn.jsdelivr.net/gh/Judera9/Pictures-for-Blogs@main/img/2022/others/image-20220317172212767.png" srcset="/img/loading.gif" lazyload alt="image-20220317172212767" style="zoom:67%;" /> <span class="math display">\[
\begin{aligned}
f_x&amp;=\int_{x_1}^{x_2}\sigma(\xi)d\xi \\
f_z&amp;=\int_{x_1}^{x_2}\rho(\xi)d\xi \\
\tau(p_x)&amp;=-\int_{x_1}^{x_2}(\xi-p_x)\rho(\xi)d\xi \\
&amp;\Rightarrow \tau(p_x)=0 \\
&amp;\Rightarrow p_x=\frac{\int_{x_1}^{x_2}\xi\rho(\xi)d\xi}{\int_{x_1}^{x_2}\rho(\xi)d\xi}
\end{aligned}
\]</span> From the equation above and the figure below, there are a few points to be concluded:</p>
<ol type="1">
<li>ZMP should locate inside the support polygon while maintaining a certain margin from the end</li>
<li>By <span class="math inline">\(\rho(\xi) \geq 0\)</span> we can obtain that <span class="math inline">\(x_1 \leq p_x \leq x_2\)</span>, that is, the ZMP always lay inside the polygon region</li>
<li>The Shear force has no contribution to the position of ZMP</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/Judera9/Pictures-for-Blogs@main/img/2022/others/image-20220317212843187.png" srcset="/img/loading.gif" lazyload alt="image-20220317212843187" style="zoom:67%;" /></p>
<h3 id="extend-to-3d">Extend to 3D</h3>
<p>It is the same with the 2D condition, just replacing integral over length with area. Since <span class="math inline">\(\rho(\xi,\eta)\)</span> is equivalent to the pressure over the surface of the sole, the point <span class="math inline">\((p_x, p_y)\)</span> is the center of pressure or in other word, ZMP.</p>
<p><img src="https://cdn.jsdelivr.net/gh/Judera9/Pictures-for-Blogs@main/img/2022/others/image-20220317214934414.png" srcset="/img/loading.gif" lazyload alt="image-20220317214934414" style="zoom:67%;" /> <span class="math display">\[
\begin{aligned}
f_z&amp;=\int_S\rho(\xi,\eta)dS \\
\tau_n(p) &amp;\equiv[\tau_{nx} \ \tau_{ny} \ \tau_{nz}]^T \\
\Rightarrow &amp;\left\{
\begin{aligned}
\tau_{nx}&amp;=\int_S(\eta-p_y)\rho(\xi,\eta)dS=0 \\
\tau_{ny}&amp;=-\int_S(\xi-p_x)\rho(\xi,\eta)dS=0 \\
\tau_{nz}&amp;=0\end{aligned}
\right. \\
\Rightarrow &amp;\left\{
\begin{aligned}
p_x=\frac{\int_S\xi\rho(\xi,\eta)dS}{\int_S\rho(\xi,\eta)dS} \\
p_y=\frac{\int_S\eta\rho(\xi,\eta)dS}{\int_S\rho(\xi,\eta)dS}
\end{aligned}
\right. \\
\end{aligned}
\]</span> Notice that one thing is different from the 2D case: <strong>the moment on z-axis is not zero for ZMP</strong>. Therefore, ZMP only control the row and pitch angle, but not the yaw angle. <span class="math display">\[
\begin{aligned}
\tau_p &amp; = [0 \ 0 \ \tau_{tz}]^T \\
\tau_{tz} &amp;=\int_S[(\xi-p_x)\sigma_y(\xi,\eta)-(\eta-p_y)\sigma_x(\xi,\eta)]dS
\end{aligned}
\]</span></p>
<h3 id="measurement-of-zmp">Measurement of ZMP</h3>
<p>When the robot moves and the foot is forced on the ground, the output of the force/torque sensor at the foot is generated. By using this sensor information, the position of the ZMP is measured.</p>
<p>The sensor used here is the 6 Axis Force/Torque Sensor, which could measure <span class="math inline">\([f_x,f_y,f_z,\tau_x,\tau_y,\tau_z]\)</span> data on a single foot. However, using multiple one dimensional force sensors or 3 axis force sensors can work as well. The general measure metric is described below:</p>
<img src="https://cdn.jsdelivr.net/gh/Judera9/Pictures-for-Blogs@main/img/2022/others/image-20220317233835889.png" srcset="/img/loading.gif" lazyload alt="image-20220317233835889" style="zoom: 67%;" /> $$
<span class="math display">\[\begin{aligned}
&amp;\mbox{&#39;j&#39; corresponds to the jth sensor measurement:} \\
\tau(p)&amp;=\sum^{N}_{j=1}(p_j-p)\times f_j+\tau_j \\
&amp;\mbox{set x and y components to zero:} \\

&amp;\Rightarrow \hat{p}\times f_j = (\hat{p}_yf_{jz}-\hat{p}_zf_{jy})i+(\hat{p}_zf_{jx}-\hat{p}_xf_{jz})j+(\hat{p}_xf_{jy}-\hat{p}_yf_{jx})k \\

&amp;\Rightarrow
\left\{
\begin{aligned}
(\hat{p}\times f_j)_y = \hat{p}_zf_{jx}-\hat{p}_xf_{jz} \\
(\hat{p}\times f_j)_x = \hat{p}_yf_{jz}-\hat{p}_zf_{jy} \\
\end{aligned}
\right. \\

\Rightarrow&amp;
\left\{
\begin{aligned}
\sum^{N}_{j=1}\hat{p}_yf_{jz}-\hat{p}_zf_{jy}+\tau_{jx}=0 \\
\sum^{N}_{j=1}\hat{p}_zf_{jx}-\hat{p}_xf_{jz}+\tau_{jy}=0
\end{aligned}
\right. \\

\Rightarrow&amp;
\left\{
\begin{aligned}
&amp;p_x = \frac{\sum^{N}_{j=1}[-\tau_{jy}-(p_{jz}-p_z)f_{jx}+p_{jx}f_{jz}]}{\sum^{N}_{j=1}f_{jz}} \\
&amp;p_y = \frac{\sum^{N}_{j=1}[\tau_{jx}-(p_{jz}-p_z)f_{jy}+p_{jy}f_{jz}]}{\sum^{N}_{j=1}f_{jz}} \\
\end{aligned}
\right. \\
\end{aligned}\]</span>
<p>$$</p>
<p>For the both feet contact, we can just combine the right and left foot ZMPs which are <span class="math inline">\(p_R, p_L\)</span>, and the forces on them are <span class="math inline">\(f_R, f_L\)</span>. The following formula is used when both feet are on the ground, otherwise use the above equations for single foot condition. <span class="math display">\[
\begin{aligned}
p_x=\frac{p_{Rx}f_{Rz}+p_{Lx}f_{Lz}}{f_{Rz}+f_{Lz}} \\
p_y=\frac{p_{Ry}f_{Rz}+p_{Ly}f_{Lz}}{f_{Rz}+f_{Lz}}
\end{aligned}
\]</span> <img src="https://cdn.jsdelivr.net/gh/Judera9/Pictures-for-Blogs@main/img/2022/others/image-20220318103239720.png" srcset="/img/loading.gif" lazyload alt="image-20220318103239720" style="zoom:67%;" /></p>
<h3 id="limitation-of-zmp">Limitation of ZMP</h3>
<p>ZMP only contains 2D constriction information, but the ground reaction force is 6 dimensional information with force/moment.</p>
<ol type="1">
<li>ZMP cannot determine whether or not the sole slips on the ground surface, and it cannot depict the yaw rotation as well. It can only describe roll and pitch for biped motion.</li>
<li>If the ground surface is not flat, the friction is uncertain, so ZMP cannot work.</li>
<li>If the arms or the hands of a humanoid robot contact the environment, ZMP need to be extended.</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/Judera9/Pictures-for-Blogs@main/img/2022/others/R.189ad494ff5812a6034397a3f47f5ce8rik=MT9araNcXOvGeA&riu=http%3a%2f%2fi.stack.imgur.com%2f65EKz.png&ehk=bSDL3CiJcolTGpJpClPnetLzgtf65cZ%2fMILbGlcd2Ns%3d&risl=&pid=ImgRaw&r=0" srcset="/img/loading.gif" lazyload alt="See the source image" style="zoom: 50%;" /></p>
<h2 id="dynamics-of-humanoid-robots">Dynamics of Humanoid Robots</h2>
<h3 id="physics-review">Physics Review</h3>
<p>Let's review the knowledge of physics:</p>
<ol type="1">
<li>Momentum is <span class="math inline">\(P=\dot{c}M\)</span>, <span class="math inline">\(c\)</span> is the CoM and M is the total mass, <span class="math inline">\(c=\sum^{N}_{i=1}m_ip_i/M\)</span>. Derived from CoM, <span class="math inline">\(\dot{c}=\sum^{N}_{i=1}m_i\dot{p_i}/M=\dot{P}/M\)</span></li>
<li>The derivative of momentum describes the force acting on the center, <span class="math inline">\(\dot{P}=f_{all}=Mg+f\)</span></li>
<li>Similar with (linear) momentum, the change of angular momentum describes torque about the origin, <span class="math inline">\(\dot{L}=\tau_{all}=c\times Mg+\tau\)</span>. When robot is still, the ground reaction moment <span class="math inline">\(\tau\)</span> applied should balance with the moment generated by gravity.</li>
<li>The angular and linear momentum has relation of <span class="math inline">\(L_i=p_i\times P_i\)</span>, which is a pseudo vector like angular velocity. The angular momentum is not only a property for rotational motion, for example, <strong>constant speed linear motion and constant speed rotation both have conservation of angular momentum</strong>.</li>
<li>The derivative of angular momentum is equal to the overall torque, proof is below:</li>
</ol>
<p><span class="math display">\[
\begin{aligned}
\dot{L_i}&amp;=\dot{p_i}\times P_i+p_i\times \dot{P_i} \\
&amp;=0+p_i\times \dot{P_i} =p_i\times m_i\ddot{p_i}\\
&amp;= \sum^{N}_{j=1}p_i\times f_{ij}^int+p_i\times f_i^{ext} \\
\dot{L}&amp;=\sum^{N}_{i=1}p_i\times f_i^{ext}=\tau_{all}
\end{aligned}
\]</span></p>
<h3 id="derive-the-inertia-tensor-of-rigid-body">Derive the Inertia Tensor of Rigid Body</h3>
<p>Using the conclusions of pseudo vector mentioned in the former blog, we proved that <span class="math inline">\(I \equiv \sum_im_i\hat{p_i}\hat{p_i}^T\)</span>, which is a 3 x 3 symmetric matrix. <span class="math display">\[
\begin{aligned}
L&amp;=\sum_ip_i\times P_i \\
&amp;=\sum_ip_i\times m_iv_i \\
&amp;=\sum_ip_i\times (m_i\omega\times p_i) \\
&amp;=\sum_im_ip_i\times (-p_i\times \omega) \\
&amp;=(\sum_im_i\hat{p_i}\hat{p_i}^T)\omega \\
&amp;=I\omega \\
\end{aligned}
\]</span> We can see from this figure that <strong>the direction of the angular momentum is usually different from that of the angular velocity</strong>. The proof is from the above equation, using a conclusion of multiple cross product, <span class="math inline">\(a\times (b\times c)=(a\cdot c)\cdot b-(a\cdot b)c\)</span>: <span class="math display">\[
\begin{aligned}
L&amp;=\sum_im_ip_i\times (\omega\times p_i) \\
&amp;=\sum_im_i[(p_i\cdot p_i)\cdot \omega-(p_i\cdot \omega)p_i]
\end{aligned}
\]</span> If <span class="math inline">\(\omega \cdot p_i=0\)</span>, then the direction of <span class="math inline">\(L\)</span> and <span class="math inline">\(\omega\)</span> are the same, that is, the rotation is vertical to the surface of the rigid body.</p>
<p><img src="https://cdn.jsdelivr.net/gh/Judera9/Pictures-for-Blogs@main/img/2022/others/image-20220319122030857.png" srcset="/img/loading.gif" lazyload alt="image-20220319122030857" style="zoom:67%;" /></p>
<p>The inertia of some uniform shape are listed in the following table, for example, the <span class="math inline">\(I\)</span> of a cuboid is below. <span class="math display">\[
I=\begin{bmatrix}
\frac{m}{12}(l_y^2+l_z^2) &amp;0&amp;0\\
0&amp;\frac{m}{12}(l_x^2+l_z^2)&amp; 0\\
0&amp;0&amp; \frac{m}{12}(l_x^2+l_y^2)
\end{bmatrix}
\]</span> <img src="https://cdn.jsdelivr.net/gh/Judera9/Pictures-for-Blogs@main/img/2022/others/momi_table.png" srcset="/img/loading.gif" lazyload alt="img" style="zoom: 55%;" /></p>
<p>The rotation frame transform for a rigid body can be done with a rotation matrix, as we discussed before. If we consider that the object is rotated due to the change of view point, we can easily understand that <strong>the relative position of both the angular velocity vector and the angular momentum vector with respect to the rigid body do not change</strong>. <span class="math display">\[
\begin{aligned}
\omega&#39; &amp;=R\omega \\
L&#39; &amp;=RL\\
\Rightarrow &amp; L&#39; = (RIR^T)\omega=\hat{I}\omega
\end{aligned}
\]</span></p>
<h2 id="code-calculation">Code Calculation</h2>
<p><img src="https://cdn.jsdelivr.net/gh/Judera9/Pictures-for-Blogs@main/img/2022/others/image-20220328172704672.png" srcset="/img/loading.gif" lazyload alt="image-20220328172704672" style="zoom: 80%;" /></p>
<h3 id="center-of-mass">Center of Mass</h3>
<ul>
<li>Calculate CoM for the j-th link as <span class="math inline">\(\overline{c}_j\)</span> in local coordinate</li>
<li>The CoM of each link in world coordinate is <span class="math inline">\(c_j=p_j+R_j\overline{c}_j\)</span></li>
<li>Divide the sum of moment by the total mass, got <span class="math inline">\(c=\sum^{N}_{j=1}m_jc_j/M\)</span></li>
</ul>
<figure class="highlight matlab"><table><tr><td class="gutter"><div class="code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><pre><code class="hljs matlab"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">mc</span> = <span class="hljs-title">calcMC</span><span class="hljs-params">(j)</span> % <span class="hljs-title">recursive</span></span><br><span class="hljs-keyword">global</span> uLINK<br><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">j</span> == <span class="hljs-number">0</span> <span class="hljs-comment">% already traverse all the links (of this branch)</span><br>    mc = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">else</span><br>    mc = uLINK(<span class="hljs-built_in">j</span>).m * (uLINK(<span class="hljs-built_in">j</span>).p + uLINK(<span class="hljs-built_in">j</span>).R * uLINK(<span class="hljs-built_in">j</span>).c );<br>    mc = mc + calcMC(uLINK(<span class="hljs-built_in">j</span>).sister) + calcMC(uLINK(<span class="hljs-built_in">j</span>).child);<br><span class="hljs-keyword">end</span><br><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">com</span> = <span class="hljs-title">calcCoM</span><span class="hljs-params">()</span></span><br><span class="hljs-keyword">global</span> uLINK<br><br>M = TotalMass(<span class="hljs-number">1</span>); <span class="hljs-comment">% add up all the mass, start from the 1st link</span><br>MC = calcMC(<span class="hljs-number">1</span>);<br>com = MC / M;<br></code></pre></td></tr></table></figure>
<h3 id="link-speed-and-angular-velocity">Link Speed and Angular Velocity</h3>
<p><span class="math display">\[
\begin{aligned}
v_j&amp;=v_i+\omega_i\times R_ib_j \\
\omega_j&amp;=\omega_i+R_ia_j\dot{q_j} \\
\end{aligned}
\]</span></p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs matlab"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ForwardVelocity</span><span class="hljs-params">(j)</span></span><br><span class="hljs-keyword">global</span> uLINK<br><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">j</span> == <span class="hljs-number">0</span> <span class="hljs-keyword">return</span>; <span class="hljs-keyword">end</span><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">j</span> ~= <span class="hljs-number">1</span><br>    <span class="hljs-built_in">i</span> = uLINK(<span class="hljs-built_in">j</span>).mother;<br>    uLINK(<span class="hljs-built_in">j</span>).v = uLINK(<span class="hljs-built_in">i</span>).v + <span class="hljs-built_in">cross</span>(uLINK(<span class="hljs-built_in">i</span>).w, uLINK(<span class="hljs-built_in">i</span>).R * uLINK(<span class="hljs-built_in">j</span>).b);<br>    <span class="hljs-comment">% w = a * dq, dq is the amplitude of omega and a is the direction</span><br>    uLINK(<span class="hljs-built_in">j</span>).w = uLINK(<span class="hljs-built_in">i</span>).w + uLINK(<span class="hljs-built_in">i</span>).R * (uLINK(<span class="hljs-built_in">j</span>).a * uLINK(<span class="hljs-built_in">j</span>).dq);<br><span class="hljs-keyword">end</span><br>ForwardVelocity(uLINK(<span class="hljs-built_in">j</span>).sister);<br>ForwardVelocity(uLINK(<span class="hljs-built_in">j</span>).child);<br></code></pre></td></tr></table></figure>
<h3 id="momentum">Momentum</h3>
<p><span class="math display">\[
\begin{aligned}
P &amp;= \sum^{N}_{j=1}m_j\dot{c_j} \\
\dot{c_j} &amp;=v_j+\omega_j\times(R_j\overline{c}_j)
\end{aligned}
\]</span></p>
<p><img src="https://cdn.jsdelivr.net/gh/Judera9/Pictures-for-Blogs@main/img/2022/others/image-20220328180716548.png" srcset="/img/loading.gif" lazyload alt="image-20220328180716548" style="zoom: 25%;" /></p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs matlab"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">P</span> = <span class="hljs-title">calcP</span><span class="hljs-params">(j)</span> % <span class="hljs-title">calculate</span> <span class="hljs-title">the</span> <span class="hljs-title">overall</span> <span class="hljs-title">momentum</span> <span class="hljs-title">recursively</span></span><br><span class="hljs-keyword">global</span> uLINK<br><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">j</span> == <span class="hljs-number">0</span><br>    P = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">else</span><br>    c1 = uLINK(<span class="hljs-built_in">j</span>).R * uLINK(<span class="hljs-built_in">j</span>).c;<br>    P = uLINK(<span class="hljs-built_in">j</span>).m * (uLINK(<span class="hljs-built_in">j</span>).v + <span class="hljs-built_in">cross</span>(uLINK(<span class="hljs-built_in">j</span>).w , c1));<br>    P = P + calcP(uLINK(<span class="hljs-built_in">j</span>).sister) + calcP(uLINK(<span class="hljs-built_in">j</span>).child);<br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>
<h3 id="angular-momentum">Angular Momentum</h3>
<p><span class="math display">\[
\begin{aligned}
L &amp;= \sum^{N}_{j=1}L_j \\
L_j &amp;= L_{joint}+L_{local} \\
&amp;= c_j\times P_j+R_j\overline{I}_jR^T_j\omega_j
\end{aligned}
\]</span></p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs matlab"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">L</span> = <span class="hljs-title">calcL</span><span class="hljs-params">(j)</span></span><br><span class="hljs-keyword">global</span> uLINK<br><br><span class="hljs-keyword">if</span> <span class="hljs-built_in">j</span> == <span class="hljs-number">0</span><br>    L = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">else</span><br>    c1 = uLINK(<span class="hljs-built_in">j</span>).R * uLINK(<span class="hljs-built_in">j</span>).c;<br>    c = uLINK(<span class="hljs-built_in">j</span>).p + c1; <span class="hljs-comment">% j-th link CoM in world coordinate</span><br>    P = uLINK(<span class="hljs-built_in">j</span>).m * (uLINK(<span class="hljs-built_in">j</span>).v + <span class="hljs-built_in">cross</span>(uLINK(<span class="hljs-built_in">j</span>).w , c1));<br>    L = <span class="hljs-built_in">cross</span>(c, P) + uLINK(<span class="hljs-built_in">j</span>).R * uLINK(<span class="hljs-built_in">j</span>).I * uLINK(<span class="hljs-built_in">j</span>).R’ * uLINK(<span class="hljs-built_in">j</span>).w;<br>    L = L + calcL(uLINK(<span class="hljs-built_in">j</span>).sister) + calcL(uLINK(<span class="hljs-built_in">j</span>).child);<br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure>
<h3 id="zmp-from-robots-motion">ZMP from Robot's Motion</h3>
<p>We should know that the reason we use ZMP is to simplify the analysis of ground reaction force. The GRF can be expressed by ZMP(<span class="math inline">\(p\)</span>), the force (<span class="math inline">\(f\)</span>) and the moment (<span class="math inline">\(\tau_p\)</span>) about the vertical line including the ZMP. <span class="math display">\[
\tau=p\times f+\tau_p
\]</span> <img src="https://cdn.jsdelivr.net/gh/Judera9/Pictures-for-Blogs@main/img/2022/others/image-20220328191437208.png" srcset="/img/loading.gif" lazyload alt="image-20220328191437208" style="zoom:67%;" /></p>
<p>In the above section, a method to measure ZMP by sensors is introduced, now we want to calculate ZMP by given motion of the robot. Through the result of below, we can observe that <strong>a special condition is when <span class="math inline">\(\dot{P}=\dot{L}=0\)</span>, the ZMP coincides with the CoM</strong>. <span class="math display">\[
\begin{aligned}
\dot{P} &amp;=Mg+f \\
\dot{L} &amp;=c\times Mg+\tau \\
&amp;\mbox{substitued back:}\\
\tau_p &amp;=\dot{L}-c\times Mg+(\dot{P}-Mg)\times p \\
&amp;\mbox{remember that:} \\
\hat{a}&amp;=\begin{bmatrix}
0 &amp; -a_z &amp; a_y \\
a_z &amp; 0 &amp; -a_x \\
-a_y &amp; a_x &amp; 0
\end{bmatrix} \\
c &amp;= [x \ y \ z]^T \\
g &amp;= [0 \ 0 \ -g]^T \\
\Rightarrow\\
&amp;\left\{
\begin{aligned}
\tau_{px} &amp;=\dot{L}_x+ Mgy+\dot{P}_yp_z-(\dot{P}_z+Mg) p_y=0 \\
\tau_{py} &amp;=\dot{L}_y- Mgx-\dot{P}_xp_z+(\dot{P}_z+Mg) p_x=0 \\
\end{aligned}
\right.\\
\Rightarrow\\
&amp;\left\{
\begin{aligned}
&amp;p_x = \frac{Mgx+\dot{P}_yp_z-\dot{L}_y}{\dot{P}_z+Mg}\\
&amp;p_y = \frac{Mgy+\dot{P}_yp_z+\dot{L}_x}{\dot{P}_z+Mg}\\
\end{aligned}
\right.
\end{aligned}
\]</span></p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs matlab"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">[px,py]</span> = <span class="hljs-title">calcZMP</span><span class="hljs-params">(c,dP,dL,pz)</span></span><br><span class="hljs-keyword">global</span> M G<br><br><span class="hljs-comment">% dP and dL are numerical differentiation of the momentum and angular momentum</span><br><span class="hljs-comment">% P and L are sequences when robot are in motion</span><br>px = (M*G*c(<span class="hljs-number">1</span>) + pz * dP(<span class="hljs-number">1</span>) - dL(<span class="hljs-number">2</span>))/(M*G + dP(<span class="hljs-number">3</span>));<br>py = (M*G*c(<span class="hljs-number">2</span>) + pz * dP(<span class="hljs-number">2</span>) + dL(<span class="hljs-number">1</span>))/(M*G + dP(<span class="hljs-number">3</span>));<br></code></pre></td></tr></table></figure>
<h3 id="calculating-zmp-by-approximation">Calculating ZMP by Approximation</h3>
As we discussed above, the angular momentum of the j-th link is as shown. To simplify the model, we ignore the inertia tensor of each link about its CoM: <span class="math display">\[
\begin{aligned}
L_j &amp;= c_j\times P_j+R_j\overline{I}_jR^T_j\omega_j \\
&amp;\approx c_j\times P_j \\
\end{aligned}
\]</span> <strong>It can be calculated with enough accuracy if we model each link by using multiple point masses</strong>. However, we can also approximate all the mass into a single CoM for the whole system, which we would use in biped gait pattern design. Below are approximation strategy based on multiple CoMs system and single CoM system. $$
<span class="math display">\[\begin{aligned}
&amp;\mbox{* Multiple CoMs System:}\\ 
L &amp;= \sum^N_{i=1}c_j\times P_j \\
\Rightarrow\\
p_x&amp;=\frac{\sum^N_{i=1}m_i\{(\ddot{z}_i+g)x_i-(z_i-p_z)\ddot{x}_i)\}}{\sum^N_{i=1}m_i(\ddot{z}_i+g)}\\
p_y&amp;=\frac{\sum^N_{i=1}m_i\{(\ddot{z}_i+g)y_i-(z_i-p_z)\ddot{y}_i)\}}{\sum^N_{i=1}m_i(\ddot{z}_i+g)}\\

&amp;\mbox{* Single CoM System:}\\ 
P&amp;=M\dot{c}=\begin{bmatrix}
M\ddot{x} \\ M\ddot{y}\\ M\ddot{z}
\end{bmatrix}\\
L&amp;=c\times M\dot{c}=\begin{bmatrix}
M(y\ddot{z}-z\ddot{y}) \\ M(z\ddot{x}-x\ddot{z})\\ M(x\ddot{y}-y\ddot{x})
\end{bmatrix}\\
\Rightarrow\\
p_x&amp;=x-\frac{(z-p_z)\ddot{x}}{\ddot{z}+g}\\
p_y&amp;=y-\frac{(z-p_z)\ddot{y}}{\ddot{z}+g}
\end{aligned}\]</span>
<p>$$ <img src="https://cdn.jsdelivr.net/gh/Judera9/Pictures-for-Blogs@main/img/2022/others/image-20220328201646072.png" srcset="/img/loading.gif" lazyload alt="image-20220328201646072" style="zoom:67%;" /></p>
<h2 id="reference">Reference</h2>
<section class="footnotes">
<div class="footnote-list">
<ol>
<li>
<span id="fn:1" class="footnote-text"><span><a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Zero_moment_point">Zero moment point</a> <a href="#fnref:1" rev="footnote" class="footnote-backref"> ↩︎</a></span></span>
</li>
<li>
<span id="fn:2" class="footnote-text"><span><a target="_blank" rel="noopener" href="http://spiff.rit.edu/classes/phys216/workshops/w9c/w9c.html">Parallel-axis theorem, torque</a> <a href="#fnref:2" rev="footnote" class="footnote-backref"> ↩︎</a></span></span>
</li>
</ol>
</div>
</section>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E8%AF%BE%E7%A8%8B%E7%9B%B8%E5%85%B3/">课程相关</a>
                    
                      <a class="hover-with-bg" href="/categories/%E8%AF%BE%E7%A8%8B%E7%9B%B8%E5%85%B3/Walking-Robot/">Walking Robot</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/ZMP/">ZMP</a>
                    
                      <a class="hover-with-bg" href="/tags/Dynamics/">Dynamics</a>
                    
                  </div>
                
              </div>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/06/13/2022-06-13-KLT-naive-version/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">光流估计目标追踪-简单的KLT Feature Tracker</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/06/12/2022-06-12-walking-robot-kinematics/">
                        <span class="hidden-mobile">行走机器人课程-运动学复习</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments" lazyload>
                
                  
                
                
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/valine@1/dist/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"A2B86e7zop7GQkkzp7ipqfER-gzGzoHsz","appKey":"tuSWVIPcIWJRbLSnVVwFn5UL","path":"window.location.pathname","placeholder":"欢迎在此处留下你的评论呀～","avatar":"robohash","meta":["nick"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":true,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          Fluid.plugins.initFancyBox('#valine .vcontent img:not(.vemoji)');
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://github.com/Judera9" target="_blank" rel="nofollow noopener"><span>Github</span></a> <i class="iconfont icon-love"></i> <a href="https://space.bilibili.com/629192924?from=search&seid=4236930356157132584&spm_id_from=333.337.0.0" target="_blank" rel="nofollow noopener"><span>Bilibili</span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
        typing(title);
      
    })(window, document);
  </script>





  

  
    <!-- MathJax -->
    <script>
      MathJax = {
        tex: {
          inlineMath: [['$', '$'], ['\\(', '\\)']]
        },
        loader: {
          load: ['ui/lazy']
        },
        options: {
          renderActions: {
            findScript: [10, doc => {
              document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
                const display = !!node.type.match(/; *mode=display/);
                const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
                const text = document.createTextNode('');
                node.parentNode.replaceChild(text, node);
                math.start = { node: text, delim: '', n: 0 };
                math.end = { node: text, delim: '', n: 0 };
                doc.math.push(math);
              });
            }, '', false],
            insertedScript: [200, () => {
              document.querySelectorAll('mjx-container').forEach(node => {
                let target = node.parentNode;
                if (target.nodeName.toLowerCase() === 'li') {
                  target.parentNode.classList.add('has-jax');
                }
              });
            }, '', false]
          }
        }
      };
    </script>

    <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js" ></script>

  











<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
